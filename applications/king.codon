import time

from sequre.attributes import sequre
from sequre.types.cipher_tensor import CipherTensor


@sequre
def collective_king_protocol(mpc, data_path, t):
    """
    param: x horizontally partitionned input
    param: t public threshold
    """
    x = CipherTensor.collective_load(data_path)
    het = [row.count(1) for row in x]
    one = CipherTensor.ones(x.T.shape)
    kinship = x * x @ one.T + (x * 2) @ x.T - one.T @ (x.T * x.T) + het * (2 - 4 * t)
    return kinship > 0
