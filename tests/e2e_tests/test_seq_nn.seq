from ..utils import assert_approx 

from sequre.mpc.env import MPCEnv
from .. import seq_neural_net_protocol


def test_seq_nn[TP](mpc: MPCEnv[TP], modulus: TP):
    with open('tests/data/output/neural_net.txt') as f:
        expected_output = [[float(e.strip()) for e in row.split(' ')] for row in f]
        nn_result_field = mpc.comms.print_fp(seq_neural_net_protocol(mpc, True, modulus), modulus)
        error = 0.014 if modulus.popcnt() == 1 else 0.0002
        if mpc.pid: assert_approx('Seq neural net (field)', nn_result_field, expected_output, error=error)

    print(f'Seq neural net passed at {mpc.pid}!\n')
