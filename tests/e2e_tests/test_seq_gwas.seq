from ..utils import assert_approx 

from sequre.mpc.env import MPCEnv
from .. import seq_gwas_protocol


def test_seq_gwas[TP](mpc: MPCEnv[TP], modulus: TP):
    with open('tests/data/output/gwas.txt') as f:
        expected_output = [float(e.strip()) for e in next(f).split(',')]
        gwas_result_field = mpc.comms.print_fp(seq_gwas_protocol(mpc, True, modulus), modulus)
        if mpc.pid: assert_approx(f'Seq GWAS ({"ring" if modulus.popcnt() == 1 else "field"})', gwas_result_field, expected_output, error=0.04)
    
    print(f'Seq GWAS ({"ring" if modulus.popcnt() == 1 else "field"}) passed at {mpc.pid}!\n')
