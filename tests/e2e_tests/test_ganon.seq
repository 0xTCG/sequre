from sequre.utils.param import *
from sequre.mpc.env import MPCEnv
from .. import ganon_classification, FilterConfig


def test_ganon[TP](mpc: MPCEnv[TP], modulus: TP):
    parsed_hierarchy = {
    "level_1": {
            "window_size": 0,
            "kmer_size": 19,
            "offset": 1,
            "rel_filter": 1,
            "abs_filter": 0,
            "alphabet_size": 5  # the size of the nucleotide alphabeth -- 5 in case of SeqAn's IBF (A,C,G,N,T)
        }
    }

    filter_config = FilterConfig(
        ibf_path="tests/data/ganon/ibf.bin",
        map_path="tests/data/ganon/ibf_map.txt",
        rel_cutoff=0.25,
        abs_cutoff=0.0,
        bin_count=63,
        hash_count=3)

    ganon_classification(mpc, parsed_hierarchy, [filter_config], 'tests/data/ganon/bac.sim.1.fasta', modulus)
    print(f'Sequre Ganon ({"ring" if modulus.popcnt() == 1 else "field"}) passed at {mpc.pid}!\n')
