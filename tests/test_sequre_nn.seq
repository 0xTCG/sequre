from utils import assert_approx 

from sequre.utils.param import *
from sequre.mpc.env import MPCEnv
from sequre.types.shared_tensor import MODULUS
from ..protocols.sequre_nn import neural_net_protocol


def test_sequre_nn[TP](mpc: MPCEnv[TP]):
    with open('tests/data/output/neural_net.txt') as f:
        expected_output = [[float(e.strip()) for e in row.split(' ')] for row in f]
        nn_result = mpc.comms.print_fp(neural_net_protocol(mpc, True).share, MODULUS)
        if mpc.pid:
            assert_approx('Sequre neural net', nn_result, expected_output, error=1)

    print(f'Sequre neural net passed at {mpc.pid}!\n')
